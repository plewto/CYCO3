<!DOCTYPE HTML>
<html lang="en">

  <head>
      <meta charset="UTF-8">
      <meta name="robots" content="index,follow,archive">
      <meta name="keywords" content="NIL">
      <link rel="stylesheet" type="text/css" href="style.css"/>
      <title>Ghost</title>
      <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'/>
  </head>
  
<body lang="en-US">
  <a id="top"></a>
  <a href=index.html class="link">Home</a> &nbsp;<a href=control-ball.html class="navigation">Previous: control-ball </a> &nbsp;<a href=specialized-parts.html class="navigation">Next: specialized-parts </a> &nbsp;<a href=contents.html class="navigation">Contents </a> &nbsp;
  <hr style='height:4px;border-width:0;color:green;background-color:gray'/>
  <h1 class="banner">Ghost</h1>
  <p class="body">
    <b>Ghost</b> are parts which generate events by tracking another part.  
    There are currently two types:
  </p>
  <ol>
    <li>key-ghost</li>
    <li>control-ghost</li>
  </ol>
  <a id="key-ghost"></a>
  <H2 class="heading">KEY-GHOST</H2>
  <p class="body">
    A <b>KEY-GHOST</b> modifies selected note events from another part.
    The ghost generates new notes from a designated channel and may modify them in 
    several ways.
  </p>
  <ul>
    <li>change channel</li>
    <li>time shift</li>
    <li>alter key-number</li>
    <li>alter velocity</li>
  </ul>
  
  <!-- (MAKE-KEY-GHOST name source-part source-channel &key ...) -->
  <!--  -->
  <!--  -->
  <b class="definition">(MAKE-KEY-GHOST name source-part source-channel &key ...)</b><br>
  
  <!-- (KEY-GHOST name source-part source-channel &key ...) -->
  <!--  -->
  <!--  -->
  <b class="definition">(KEY-GHOST name source-part source-channel &key ...)</b><br>
  <pre class="description">
    KEY-GHOST and MAKE-KEY-GHOST are identical except the later binds
    the new part to the symbol name.  The name argument should be a quoted symbol 
    for MAKE-KEY-GHOST and unquoted for KEY-GHOST.
    
    name           - Symbol
    source-part    - Part to track.
    source-channel - <a href='glossary.html#midi-channel-designator'>MIDI channel designator</a>, the channel to be tracked.
    :out-channels  - Channel designator or list of designators.  Events are generated for each channel., 
                     Defaults to source-channel.
    :delay         - Metric-expression, delay time, default 0.0
    :key-map       - Function to map MIDI key-numbers, see below. Defaults to #'identity
    :velocity-map  - Function to map note-on velocities, see below. Defaults to #'identity
    :render-once   - Boolean, if true do not repeat, default nil.
    :remarks       - Optional remarks text.
    
    
    The arguments to key-map and velocity-map may either be functions, list or simple-vectors. 
    
              (lambda (n) ) --> m
    
    where n is the original value   n &isin; (0, 1, 2, ..., 127) and result m &isin; (... 0, 1, 2, ..., 127)
    No note is generated if either the new key-number or velocity is negative.
    
    If the argument is a list or vector, it is converted to a function.   Out of bounds values are mapped
    to -1.
  </pre>
  <H4 class="heading">Examples</H4>
  <p class="body">
    Slap back echo.
  </p>
  <pre class="code">
    (simple-part piano-part piano :events ....)
    
    (key-ghost piano-echo piano-part piano 
               :delay 0.05
               :velocity-map #'(lambda (v)(truncate (* 0.5 v))))
  </pre>
  <p class="body">
    Duplicate piano on organ
  </p>
  <pre class="code">
    (simple-part piano-part piano :events ....)
    
    (key-ghost piano-part piano :out-channels organ)
  </pre>
  <p class="body">
    Duplicate piano on organ and marimba, transposed up an octave
  </p>
  <pre class="code">
    (simple-part piano-part piano :events ....)
    
    (key-ghost piano-part piano
               :out-channels (list organ marimba)
               :key-map #'(lambda (k)(transpose k 12)))
  </pre>
  <p class="body">
    Using list as a key-table to invert notes.
  </p>
  <pre class="code">
    (simple-part piano-part piano :events ....)
    
    (key-ghost piano-part piano
               :out-channel organ
               :key-map (range 127 -1 :by -1))
  </pre>
  <a id="control-ghost"></a>
  <hr style='height:4px;border-width:0;color:green;background-color:gray'/>
  <H2 class="heading">CONTROL-GHOST</H2>
  <p class="body">
    A <b>CONTROL-GHOST</b> tracks selected MIDI control-change events of another part.
    The generated events may be modified in the following ways.
  </p>
  <ul>
    <li>channel changed</li>
    <li>new controller number</li>
    <li>altered values.</li>
  </ul>
  
  <!-- (MAKE-CONTROL-GHOST name source-part source-controller source-channel &key ...) -->
  <!--  -->
  <!--  -->
  <b class="definition">(MAKE-CONTROL-GHOST name source-part source-controller source-channel &key ...)</b><br>
  
  <!-- (CONTROL-GHOST name source-part source-controller source-channel &key ...) -->
  <!--  -->
  <!--  -->
  <b class="definition">(CONTROL-GHOST name source-part source-controller source-channel &key ...)</b><br>
  <pre class="description">
    CONTROL-GHOST and MAKE-CONTROL-GHOST are identical except the later binds
    the new part to the symbol name.   The name argument should be quoted for MAKE-CONTROL-GHOST 
    and unquoted for CONTROL-GHOST.
    
    name              - Symbol.
    source-part       - The part to track.
    source-controller - The controller number to track within source-part.
    source-channel    - <a href='glossary.html#midi-channel-designator'>MIDI channel designator</a>, the channel to be tracked.
    :out-controller   - The output controller number, defaults to source-controller.
    :out-channels     - The output channel, or list of channels.  Events are generated for
                        each out channel.  Defaults to source channel.
    :delay            - Metric-expression, default 0.0
    :value-map        - Function to map controller values.  Defaults to identity.
    :render-once      - Boolean, if true do not repeat events, default nil.
    :remarks          - Optional remarks.
  </pre>
  <hr style='height:4px;border-width:0;color:green;background-color:gray'/>
  <a href=index.html class="link">Home</a> &nbsp;<a href=control-ball.html class="navigation">Previous: control-ball </a> &nbsp;<a href=specialized-parts.html class="navigation">Next: specialized-parts </a> &nbsp;<a href=#top class="navigation">Top </a> &nbsp;<a href=contents.html class="navigation">Contents </a> &nbsp;
  
</body>
</html>