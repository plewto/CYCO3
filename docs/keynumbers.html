<!DOCTYPE HTML>
<html lang="en">

  <head>
      <meta charset="UTF-8">
      <meta name="robots" content="index,follow,archive">
      <meta name="keywords" content="NIL">
      <link rel="stylesheet" type="text/css" href="style.css"/>
      <title>Key Numbers</title>
      <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'/>
      <link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'/>
  </head>
  
<body lang="en-US">
  <a id="top"></a>
  <a href=index.html class="link">Home</a> &nbsp;<a href=index.html class="navigation">Previous: index </a> &nbsp;<a href=dynamics.html class="navigation">Next: dynamics </a> &nbsp;<a href=contents.html class="navigation">Contents </a> &nbsp;
  <hr/>
  <img class="center" src="images/keynumbers.png" alt="keynumbers"/>
  <h1 class="banner">CYCO Key-Numbers</h1>
  <p class="body">
    All integer values are treated as valid key-numbers, however values outside the 
    closed interval [0, 127] are treated differently.
  </p>
  <ul>
    <li>Negative integers are treated as a rest.</li>
    <li>Values between 0 and 127 inclusive correspond to MIDI key-numbers.</li>
    <li>Values greater then 127 are transposed down by octaves such that the result is a valid MIDI key-number.</li>
  </ul>
  <H3 class="heading">Rest</H3>
  <p class="body">
    The constant <b>+REST+</b> is the canonical rest and has a value of -1.   All keynumber related functions convert any
    negative value to -1.
  </p>
  <H3 class="heading">Symbolic Key Numbers</H3>
  <p class="body">
    The general form for a symbolic keynumber is
  </p>
  <pre class="code">
    W[A][O]
    
    Where:
    
        W is a 'white' key, One of: C D E F G A or B
    
        [A] is an optional 'accidental'
            F for flat
            S for sharp
    
        [O] is optional octave number between 0 and 10, default 0.
  </pre>
  <H5 class="heading">Examples</H5>
  <pre class="code">
    C5   - middle C              keynumber 60
    CS5  - C# above middle C     keynumber 61
    AF4  - Ab below middle C     keynumber 56
    G    - G in octave 0         keynumber 7
    
    Enharmonic pitches are defined:
    
    CF4 == B4                    keynumber 59
    BS4 == C5                    keynumber 60   *TODO BUG 0006,  'BS produces an error. 
    EF4 == F4                    keynumber 53
    FF4 == E4                    keynumber 52
    
    The special keynumber 'R indicates a rest,  keynumber -1
  </pre>
  <H5 class="heading">Functions on key numbers.</H5>
  <p class="body">
    Most key number related functions may take a single value or a list of values.  
    When the argument is a list, the function is applied to each element of the list and
    returns a new list.
  </p>
  <hr/>
  <a id="keynumber-function"></a>
  
  <!-- (KEYNUMBER item) -->
  <!--  -->
  <!--  -->
  <b class="definition">(KEYNUMBER item)</b><br>
  <p class="summery">Returns MIDI keynumber(s) of item.</p>
  <pre class="description">
    The argument may be an integer, symbolic key-number or list of key-numbers.
    
    (KEYNUMBER -100) -->  -1, all negative values treated as rest.
    (KEYNUMBER 'R)   -->  -1, symbolic rest.
    (KEYNUMBER 60)   -->  60, integers between 0 and 127 returned as MIDI key number.
    (KEYNUMBER 999)  --> 123, out of bounds integers transposed to valid MIDI key number.
    (KEYNUMBER '(20 30 R (C4 CS5)) --> (20 30 -1 (48 61))
  </pre>
  <hr/>
  <a id="pitch-class"></a>
  
  <!-- (PITCH-CLASS item) -->
  <!--  -->
  <!--  -->
  <b class="definition">(PITCH-CLASS item)</b><br>
  <p class="summery">Returns key-number mod 12 of item.</p>
  <pre class="description">
    The argument may be an integer, symbolic key-number or list of key-numbers.
    
    (PITCH-CLASS -100)  --> -1, the pitch-class for all negative values is -1.
    (PITCH-CLASS 'R)    --> -1
    (PITCH-CLASS 60)    --> 0
    (PITCH-CLASS 61)    --> 1
    (PITCH-CLASS 'D4)   --> 2
    (PITCH-CLASS '(20 30 r (C4 CS5)) --> (8 6 -1 (0 1))
  </pre>
  <hr/>
  <a id="octave"></a>
  
  <!-- (OCTAVE item) -->
  <!--  -->
  <!--  -->
  <b class="definition">(OCTAVE item)</b><br>
  <p class="summery">Returns octave number(s) of item.</p>
  <pre class="description">
    The argument may be an integer, symbolic key-number or list of key-numbers.
    
    (OCTAVE -987)    --> -1, the octave of all negative numbers is -1.
    (OCTAVE 'R)      --> -1
    (OCTAVE 60)      --> 5
    (OCTAVE 78)      --> 6
    (OCTAVE 'B4)     --> 4
    (OCTAVE '(20 30 R (C4 CS5)) -> (1 2 -1 (4 5))
  </pre>
  <hr/>
  <a id="keyname"></a>
  
  <!-- (KEYNAME item) -->
  <!--  -->
  <!--  -->
  <b class="definition">(KEYNAME item)</b><br>
  <p class="summery">Returns symbolic key name of item.</p>
  <pre class="description">
    The argument may be an integer, symbolic key-number or list of key-numbers.
    
    (KEYNAME -100)  --> R
    (KEYNAME 'R)    --> R
    (KEYNAME 60)    --> C5
    (KEYNAME 'B4)   --> B4
    (KEYNAME '(20 30 R (C4 CS5)) -> (GS1 FS2 R (C4 CS5))
    
    Where a key number has two possible names, such as for B-flat and A-sharp, keyname
    returns the sharp version.
    
    (KEYNUMBER 'AS4) --> 58
    (KEYNUMBER 'BF4) --> 58
    (KEYNAME 58)     --> AS4
  </pre>
  <hr/>
  
  <!-- (REST-P item) -->
  <!--  -->
  <!--  -->
  <b class="definition">(REST-P item)</b><br>
  <p class="summery">Predicate, returns T if item is a rest.</p>
  <hr/>
  
  <!-- (KEYNUMBER-P item) -->
  <!--  -->
  <!--  -->
  <b class="definition">(KEYNUMBER-P item)</b><br>
  <p class="summery">Predicate, returns T if item may be treated as a keynumber.</p>
  <hr/>
  
  <!-- (DEFKEYNUMBER symbol value) -->
  <!--  -->
  <!--  -->
  <b class="definition">(DEFKEYNUMBER symbol value)</b><br>
  <p class="summery">Defines user key-number.</p>
  <hr/>
  <a id="transpose"></a>
  
  <!-- (TRANSPOSE item amount) -->
  <!--  -->
  <!--  -->
  <b class="definition">(TRANSPOSE item amount)</b><br>
  <pre class="description">
    TRANSPOSE is a generic function defined for a wide range of types.
    In the context of keynumbers it applies key-transposition to the item argument.
    
    (TRANSPOSE 60 8)  --> 68
    (TRANSPOSE 'C5 8) --> GS5
    
    It may be applied to list of key-numbers
    
    (TRANSPOSE '(20 30 (C5 A5)) 8) --> (28 38 (GS5 F6))
    
    Negative values are treated as rest
    
    (TRANSPOSE -3 39)  --> -1
    (TRANSPOSE 'R 119) -->  R
    
    Edge cases do not blow up.
    
    (TRANSPOSE 10 -13)   --> 9
    (TRANSPOSE 100 1234) --> 122
    
    TRANSPOSE is also defined for a wide range of more complex types as detailed elsewhere.
    When applied to a type for which it is not defined, TRANSPOSE returns the item argument.
    
    (TRANSPOSE whatever ignore) --> whatever
    
    This also applies to non-keynumber symbols.
    
    (TRANSPOSE 'snare-hit 15) --> snare-hit
  </pre>
  <hr/>
  <a id="invert"></a>
  
  <!-- (INVERT item pivot-key) -->
  <!--  -->
  <!--  -->
  <b class="definition">(INVERT item pivot-key)</b><br>
  <pre class="description">
    INVERT is a generic function defined for a wide rage of types.
    In the context of keynumbers it applies key-inversion around the pivot-key.
    
    (INVERT 64 60)  --> 56
    (INVERT 56 60)  --> 64
    
    The pivot key may be a symbolic key-number
    
    (INVERT 64 'C5) --> 56
    
    INVERT may be applied to list of key-numbers
    
    (INVERT '(20 30 (CS5 A6)) 'C5) --> (100 90 (59 39))
    
    
    Rest are not effected
    
    (INVERT -19 60) --> -1
    (INVERT 'R 60)  --> -1
     
    Invert is also defined for a wide range of more complex types as defined elsewhere.
    When applied to a type or symbol for which it is not defined, invert returns the item
    argument.
    
    (INVERT whatever ignore) --> whatever
    (INVERT 'snare-hit ignore) --> snare-hit
  </pre>
  <hr/>
  <a href=index.html class="link">Home</a> &nbsp;<a href=index.html class="navigation">Previous: index </a> &nbsp;<a href=dynamics.html class="navigation">Next: dynamics </a> &nbsp;<a href=#top class="navigation">Top </a> &nbsp;<a href=contents.html class="navigation">Contents </a> &nbsp;
  
</body>
</html>